<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFF æš´åŠ›é™¤éŒ¯</title>
    <style>
        body { padding: 20px; font-family: sans-serif; }
        #log { background: #eee; padding: 10px; border: 1px solid #999; min-height: 100px; font-family: monospace; }
        h2 { color: #d32f2f; }
        button { font-size: 20px; padding: 20px; width: 100%; margin-top: 20px; background: #00B900; color: white; border: none; border-radius: 8px;}
    </style>
    
    <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
    <script>
        // åˆå§‹åŒ– vConsole
        var vConsole = new VConsole();
    </script>
</head>
<body>
    <h2>ğŸ¤¬ æš´åŠ›é™¤éŒ¯æ¨¡å¼</h2>
    <p>è«‹é»æ“Šå³ä¸‹è§’çš„ç¶ è‰²æŒ‰éˆ• `vConsole`ï¼Œç„¶å¾Œé» `Log` é ç±¤æˆªåœ–çµ¦æˆ‘çœ‹ã€‚</p>
    
    <div id="status">ç¨‹å¼è¼‰å…¥ä¸­...</div>
    <div id="log"></div>
    
    <button onclick="window.location.reload()">ğŸ”„ é‡æ–°æ•´ç†é é¢</button>

    <script>
        // è¨­å®šä½ çš„ LIFF ID
        const MY_LIFF_ID = '2008638301-NeqDPLxQ';

        function myLog(msg) {
            const el = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            el.innerHTML += `[${time}] ${msg}<br>`;
            console.log(msg); // é€™æœƒå°åœ¨ vConsole è£¡
        }

        // 2. æ•æ‰å…¨åŸŸéŒ¯èª¤ (å¦‚æœèªæ³•éŒ¯äº†ï¼Œé€™è£¡æœƒæŠ“åˆ°)
        window.onerror = function(message, source, lineno, colno, error) {
            myLog(`âŒ åš´é‡éŒ¯èª¤: ${message}`);
            alert(`æŠ“åˆ°äº†ï¼éŒ¯èª¤ï¼š${message}`);
        };

        // 3. å‹•æ…‹è¼‰å…¥ LIFF SDK (ç›£æ§å®ƒåˆ°åº•æœ‰æ²’æœ‰è¼‰ä¸‹ä¾†)
        myLog('é–‹å§‹ä¸‹è¼‰ LIFF SDK...');
        
        const script = document.createElement('script');
        script.src = 'https://static.line-scdn.net/liff/sdk/2/liff.js';
        
        script.onload = function() {
            myLog('SDK ä¸‹è¼‰æˆåŠŸï¼Œé–‹å§‹ init...');
            initLiff();
        };
        
        script.onerror = function() {
            myLog('âŒ SDK ä¸‹è¼‰å¤±æ•—ï¼å¯èƒ½æ˜¯ç¶²è·¯æ“‹ä½äº†');
            alert('SDK ä¸‹è¼‰å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯');
        };
        
        document.head.appendChild(script);

        // 4. åˆå§‹åŒ–é‚è¼¯
        function initLiff() {
            if (!window.liff) {
                myLog('âŒ window.liff é‚„æ˜¯ç©ºçš„ï¼è¦‹é¬¼äº†');
                return;
            }

            liff.init({ liffId: MY_LIFF_ID })
                .then(() => {
                    myLog('âœ… LIFF init æˆåŠŸï¼');
                    if (liff.isLoggedIn()) {
                        liff.getProfile().then(p => {
                            myLog(`ğŸ‰ æŠ“åˆ°äººå: ${p.displayName}`);
                            document.getElementById('status').innerText = `å—¨ï¼Œ${p.displayName}`;
                            alert(`æˆåŠŸï¼æŠ“åˆ°: ${p.displayName}`);
                        });
                    } else {
                        myLog('å°šæœªç™»å…¥ï¼Œæº–å‚™è·³è½‰...');
                        liff.login();
                    }
                })
                .catch(err => {
                    myLog(`âŒ Init å¤±æ•—: ${err.code} ${err.message}`);
                    // é€™è£¡æœ€é‡è¦ï¼Œé¡¯ç¤ºè©³ç´°éŒ¯èª¤
                    console.error(err); 
                    alert(`Init å¤±æ•—: ${err.message}`);
                });
        }
    </script>
</body>
</html>
