<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFF ç™»å…¥è¨ºæ–·</title>
    <script src="https://static.line-scdn.net/liff/sdk/2/liff.js"></script>
    <style>
        body { padding: 20px; font-family: sans-serif; word-break: break-all; }
        #log { background: #f0f0f0; padding: 10px; border: 1px solid #ccc; font-family: monospace; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        button { font-size: 20px; padding: 15px; width: 100%; margin-top: 20px; }
    </style>
</head>
<body>
    <h2>ğŸ•µï¸ LIFF ç™»å…¥è¨ºæ–·</h2>
    <div id="status">æº–å‚™ä¸­...</div>
    <div id="log"></div>

    <button id="loginBtn" style="display:none;" onclick="liff.login()">æ‰‹å‹•ç™»å…¥ LINE</button>

    <script>
        const MY_LIFF_ID = '2008638301-NeqDPLxQ'; 

        function log(msg) {
            const dom = document.getElementById('log');
            dom.innerHTML += `[${new Date().toLocaleTimeString()}] ${msg}<br>`;
            console.log(msg);
        }

        function setStatus(msg, color='black') {
            const dom = document.getElementById('status');
            dom.innerText = msg;
            dom.style.color = color;
        }

        window.onload = function() {
            log('é é¢è¼‰å…¥å®Œæˆ');
            log('æ­£åœ¨æª¢æŸ¥ LIFF SDK...');

            if (!liff) {
                setStatus('LIFF SDK è¼‰å…¥å¤±æ•—', 'red');
                log('éŒ¯èª¤: window.liff æœªå®šç¾©ï¼Œå¯èƒ½æ˜¯ç¶²è·¯æ“‹ä½äº† SDK');
                return;
            }

            log(`SDK ç‰ˆæœ¬: ${liff.getVersion()}`);
            log('é–‹å§‹åŸ·è¡Œ liff.init()...');

            liff.init({ liffId: MY_LIFF_ID })
                .then(() => {
                    log('âœ… liff.init() æˆåŠŸï¼');
                    
                    // æª¢æŸ¥æ˜¯å¦åœ¨ LINE App å…§
                    if (liff.isInClient()) {
                        log('ç’°å¢ƒ: LINE App å…§');
                        checkLogin();
                    } else {
                        log('ç’°å¢ƒ: å¤–éƒ¨ç€è¦½å™¨');
                        checkLogin();
                    }
                })
                .catch(err => {
                    setStatus('åˆå§‹åŒ–å¤±æ•—', 'red');
                    log(`âŒ liff.init éŒ¯èª¤: ${err.code} - ${err.message}`);
                    log('è«‹æª¢æŸ¥ç¶²è·¯é€£ç·šï¼Œæˆ–æ˜¯å¦ä½¿ç”¨äº† VPN/æ“‹å»£å‘Šè»Ÿé«”');
                });
        };

        function checkLogin() {
            if (liff.isLoggedIn()) {
                setStatus('ç™»å…¥æˆåŠŸï¼', 'green');
                log('å·²å–å¾—ç™»å…¥ç‹€æ…‹');
                
                liff.getProfile()
                    .then(profile => {
                        log(`âœ… æŠ“åˆ°ç”¨æˆ¶: ${profile.displayName}`);
                        log(`ID: ${profile.userId}`);
                        setStatus(`å—¨ï¼Œ${profile.displayName}ï¼æ¸¬è©¦æˆåŠŸ`, 'green');
                        alert(`æˆåŠŸï¼æŠ“åˆ° ID: ${profile.userId}`);
                    })
                    .catch(err => {
                        log(`âŒ æŠ“å– Profile å¤±æ•—: ${err.message}`);
                    });
            } else {
                setStatus('å°šæœªç™»å…¥', 'orange');
                log('åµæ¸¬åˆ°æœªç™»å…¥ç‹€æ…‹');
                document.getElementById('loginBtn').style.display = 'block';
                // è‡ªå‹•å˜—è©¦ç™»å…¥
                log('å˜—è©¦è‡ªå‹•è·³è½‰ç™»å…¥...');
                liff.login(); 
            }
        }
    </script>
</body>
</html>
